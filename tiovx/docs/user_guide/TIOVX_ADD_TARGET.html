<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TIOVX User Guide: Adding New Targets to TIOVX</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TIOVX User Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('TIOVX_ADD_TARGET.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Adding New Targets to TIOVX </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#TIOVX_TARGET_EXPLANATION">Explanation of Targets in TIOVX</a></li>
<li class="level1"><a href="#TIOVX_CORE_TARGETS">Available Targets on Each Core</a><ul><li class="level2"><a href="#J784S4_R5F_CORES">R5F Cores</a></li>
<li class="level2"><a href="#J784S4_A72_C7X_CORES">A72 and C7x Cores</a></li>
</ul>
</li>
<li class="level1"><a href="#TIOVX_TARGET_CODE_CHANGES">Code Changes to Enable More Targets</a><ul><li class="level2"><a href="#STEP1">Step 1</a></li>
<li class="level2"><a href="#STEP2">Step 2</a></li>
<li class="level2"><a href="#STEP3">Step 3</a></li>
<li class="level2"><a href="#STEP4">Step 4</a></li>
<li class="level2"><a href="#STEP5">Step 5</a></li>
</ul>
</li>
<li class="level1"><a href="#TIOVX_TARGET_PRIORITY">Disclaimer about &quot;priority&quot; argument for TIOVX targets</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="TIOVX_TARGET_EXPLANATION"></a>
Explanation of Targets in TIOVX</h1>
<p>A good place to start in understanding the concept of a "target" in TIOVX is to compare and contrast it with the concepts of "CPU" and "core" on a TI SoC. TI's SoC's have a number of heterogenous cores, such as ARM's, DSP's and HWA's. However, only the cores that run an operating system, such as FREERTOS, are considered CPU's. When comparing these concepts to the definition of a "target" in TIOVX, a target is simply a thread running on a given CPU.</p>
<p>TIOVX provides one or more target threads for each of the given CPU's. Additionally, for each of the HWA's, TIOVX has a thread running on the R5F (MCU2_0) to call into the VPAC HWA's. In the graph based model of TIOVX, a given node is assigned to a target thread. When the graph is processed, if multiple nodes are assigned to the same target, each node processing call will run to completion on the given target before the next node on that target becomes available. Additionally, in the case of HWA targets, a target becomes unblocked once the R5F initiates the processing on the HWA because it is pending on the completion of processing on the HWA. For additional details, please refer to <a class="el" href="TIOVX_TARGET_EXECUTION.html">Target Execution Model</a></p>
<p>For a list of default targets that TI provides as part of TIOVX for this SDK, refer to <a class="el" href="group__group__tivx__ext__targets.html">a: TI Targets</a></p>
<h1><a class="anchor" id="TIOVX_CORE_TARGETS"></a>
Available Targets on Each Core</h1>
<p>The available targets on each core vary depending on the architecture of its SoC. They are listed as follows:</p>
<h2><a class="anchor" id="J784S4_R5F_CORES"></a>
R5F Cores</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">MCU2_0  </th><th class="markdownTableHeadCenter">MCU2_1  </th><th class="markdownTableHeadCenter">MCU3_0  </th><th class="markdownTableHeadCenter">MCU3_1  </th><th class="markdownTableHeadCenter">MCU4_0  </th><th class="markdownTableHeadCenter">MCU4_1   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TIVX_TARGET_ID_MCU2_0  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_MCU2_1  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_MCU3_0  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_MCU3_1  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_MCU4_0  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_MCU4_1   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">TIVX_TARGET_ID_VPAC_NF  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_DMPAC_SDE  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_VPAC2_NF  </td><td class="markdownTableBodyCenter">-   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TIVX_TARGET_ID_VPAC_LDC1  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_DMPAC_DOF  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_VPAC2_LDC1  </td><td class="markdownTableBodyCenter">-   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">TIVX_TARGET_ID_VPAC_MSC[1 - 2]  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_VPAC2_MSC[1-2]  </td><td class="markdownTableBodyCenter">-   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TIVX_TARGET_ID_VPAC_VISS1  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_VPAC2_VISS1  </td><td class="markdownTableBodyCenter">-   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">TIVX_TARGET_ID_CAPTURE[1 - 12]  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TIVX_TARGET_ID_DISPLAY[1 - 2]  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">TIVX_TARGET_ID_CSITX[2]  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TIVX_TARGET_ID_DISPLAY_M2M[1-4]  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">-   </td></tr>
</table>
<h2><a class="anchor" id="J784S4_A72_C7X_CORES"></a>
A72 and C7x Cores</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">A72 MPU  </th><th class="markdownTableHeadCenter">C7x_1  </th><th class="markdownTableHeadCenter">C7x_2  </th><th class="markdownTableHeadCenter">C7x_3  </th><th class="markdownTableHeadCenter">C7x_4   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TIVX_TARGET_ID_MPU_[0-3]  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_DSP_C7_1<br />
(TIVX_TARGET_ID_DSP_C7_1_PRI_1)  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_DSP_C7_2<br />
(TIVX_TARGET_ID_DSP1)<br />
(TIVX_TARGET_ID_DSP_C7_2_PRI_1)  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_DSP_C7_3<br />
(TIVX_TARGET_ID_DSP_C7_3_PRI_1)  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_DSP_C7_4<br />
(TIVX_TARGET_ID_DSP_C7_4_PRI_1)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_DSP_C7_1_PRI_[2 - 8]  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_DSP_C7_2_PRI_[2 - 8]  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_DSP_C7_3_PRI_[2 - 8]  </td><td class="markdownTableBodyCenter">TIVX_TARGET_ID_DSP_C7_4_PRI_[2 - 8]   </td></tr>
</table>
<h1><a class="anchor" id="TIOVX_TARGET_CODE_CHANGES"></a>
Code Changes to Enable More Targets</h1>
<p>In certain situations, multiple target threads may need to be added to a given CPU beyond the single target provided by TIOVX. (For exapmle, in the case of pipelining applications and two algorithms must run in parallel on the same core.) In this case, the framework requires a set of changes to enable the new target. These changes are described in the steps below.</p>
<h2><a class="anchor" id="STEP1"></a>
Step 1</h2>
<p>File to change: <a class="el" href="tivx_8h.html" title="Interface to TI extension APIs. ">include/TI/tivx.h</a></p>
<p>Required Changes: A new #define needs to be added for the new target name. The #define follows the pattern of TIVX_TARGET_&lt;New target name&gt;. The #define should be a unique string identifier.</p>
<h2><a class="anchor" id="STEP2"></a>
Step 2</h2>
<p>File to change: source/platform/targets/soc/tivx_target_config_&lt;soc&gt;.h</p>
<p>Required Changes: The TIVX_PLATFORM_MAX_TARGETS must be increased by the number of new targets added.</p>
<h2><a class="anchor" id="STEP3"></a>
Step 3</h2>
<p>File to change: source/platform/targets/soc/tivx_target_config_&lt;soc&gt;.h</p>
<p>Required Changes: The new enumeration value for the new target must be added to the tivx_target_id_e enumeration in the format TIVX_TARGET_ID_&lt;New target name&gt;. This must be set equal to TIVX_MAKE_TARGET_ID with the first argument being the CPU ID that this new target is to be run on and the second argument being the 1 plus the existing number of threads on that target.</p>
<h2><a class="anchor" id="STEP4"></a>
Step 4</h2>
<p>File to change: source/platform/targets/soc/tivx_target_config_&lt;soc&gt;.h</p>
<p>Required Changes: The #define from <a class="el" href="TIOVX_ADD_TARGET.html#STEP1">Step 1</a> and the enumeration from <a class="el" href="TIOVX_ADD_TARGET.html#STEP3">Step 3</a> must be added to the TIVX_TARGET_INFO structure. For example, the DSP1 target is added to this structure with the line {<a class="el" href="group__group__tivx__ext__targets.html#gab68210419fad8fb7be1a93197de2c106">TIVX_TARGET_DSP1</a>, (vx_enum)TIVX_TARGET_ID_DSP1}.</p>
<h2><a class="anchor" id="STEP5"></a>
Step 5</h2>
<p>File to change: Dependent on chosen CPU. Available options:</p><ul>
<li>MPU Targets: source/platform/targets/tivx_target_config_mpu1_0.c</li>
<li>R5F Targets: source/platform/targets/r5f/tivx_target_config_r5f_&lt;soc&gt;.c</li>
<li>C66X Targets: source/platform/targets/tivx_target_config_c66.c</li>
<li>C7X Targets: source/platform/targets/tivx_target_config_c7.c</li>
</ul>
<p>Required Changes: The target thread must created in the appropriate file depending on the CPU that this new thread must be run on. The API to create the new thread is <a class="el" href="group__group__tivx__platform.html#gafc2a8140a8e0ca9fca9fc783cf181bc8" title="Create target ID. ">tivxPlatformCreateTargetId()</a>. Each of these files are slightly different in the way that they call this API. Regardless of the file, the <a class="el" href="group__group__tivx__platform.html#gafc2a8140a8e0ca9fca9fc783cf181bc8" title="Create target ID. ">tivxPlatformCreateTargetId()</a> must be called with the first argument being the target ID enumeration created in <a class="el" href="TIOVX_ADD_TARGET.html#STEP3">Step 3</a>. The second parameter will be dependent on the desired parameters of the developer.</p>
<h1><a class="anchor" id="TIOVX_TARGET_PRIORITY"></a>
Disclaimer about "priority" argument for TIOVX targets</h1>
<p>One of the parameters to the <a class="el" href="group__group__tivx__platform.html#gafc2a8140a8e0ca9fca9fc783cf181bc8">tivxPlatformCreateTargetId</a> API is "priority". The value of the priority set for this argument is based on the OS priorities of which the core is running. Therefore, when adding a new target to a given core, the developer should be aware of which OS is being used on that core. This is of particular interest because the priority ordering is different in Linux vs in QNX/FreeRTOS/SafeRTOS. A few references for this information can be found for <a href="https://stackoverflow.com/questions/3649281/how-to-increase-thread-priority-in-pthreads" target="_blank">Linux</a>, <a href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.prog/topic/overview_Priority_range.html" target="_blank">QNX</a>, and <a href="https://www.freertos.org/RTOS-task-priority.html" target="_blank">FreeRTOS</a>.</p>
<p>TIOVX supports Linux/QNX on the A72 and FreeRTOS/SafeRTOS on the R5F/C66/C7X and thus the priorities set for the tasks running on each of these cores is taken into account and optimized for the use cases of interest for the TIOVX framework. For instance, the capture target is running at the highest priority level for the R5F OS in order to prioritze the receiving of capture frames within a given system. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="REFERENCES.html">User Resources</a></li><li class="navelem"><a class="el" href="TIOVX_USAGE.html">TIOVX Usage</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
